{% extends 'movies/base.html' %}
{% load static %}
{% block movies_list %}
<div id="movieContainer" class="movieContainer">
  {% for movie in movies %}
    <div
      class="movieItem"
      data-id="{{ movie.id }}"
      data-title="{{ movie.title|default:''|escape }}"
      data-voters="{% for v in movie.votes.all %}{{ v.username|escape }}{% if not forloop.last %}|{% endif %}{% endfor %}"
      data-vote-count="{{ movie.votes.count }}"
      data-has-voted="{% if current_user in movie.votes.all %}1{% else %}0{% endif %}"
      {% if movie.imgURL %}style="background-image:url('{{ movie.imgURL }}');background-size:cover;background-position:center;background-repeat:no-repeat;"
      {% else %}style="background-image:url('{% static 'movies/ui/default_poster.png' %}');background-size:cover;background-position:center;background-repeat:no-repeat;"
      {% endif %}
    >
      <div class="movie-overlay">

        {% if not movie.imgURL %}
          <h3>{{ movie.title|default:"Unbekannter Titel" }}</h3>
        {% endif %}

        <!-- 
        <h5>{{ movie.runtime|default:"--" }} min  || {{ movie.tomatoMeter|default:"--"}} üçÖ</h5> -->



        <div class="vote-avatars">
          {% with voters=movie.votes.all %}
            {% if voters %}
              {% for voter in voters %}
                <div class="vote-avatar" title="{{ voter.username }}">
                  {% if voter.userprofile.profile_image %}
                    <img src="{{ voter.userprofile.profile_image.url }}" alt="{{ voter.username }}">
                  {% else %}
                    {{ voter.username|first|upper }}
                  {% endif %}
                </div>
              {% endfor %}
            {% endif %}
          {% endwith %}
        </div>  


        <div class="button-container-horizontal">

          <a href="{% url 'movies:movie_page' movie.id %}" target="_blank" rel="noopener noreferrer">
            <button type="button">Page</button>
          </a>


        {% if current_user in movie.votes.all %}
          <form method="post" action="{% url 'movies:movie_unvote' movie.id %}">
            {% csrf_token %}
            <button type="submit">Unvote</button>
          </form>
        {% else %}
          <form method="post" action="{% url 'movies:movie_vote_search' movie.id movie.title %}">
            {% csrf_token %}
            <button type="submit">Vote</button>
          </form>
        {% endif %}
        </div>

      </div>
    </div>
  {% endfor %}
</div>
{% endblock %}
