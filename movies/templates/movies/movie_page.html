{% load static %}
<!DOCTYPE html>
<html lang="de">
  <head>
      <link rel="icon" type="image/png" href="{% static 'movies/ui/PizzaAhegao.png' %}">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{movie.title|default:"^^"}}</title>
    <link rel="stylesheet" href="{% static 'movies/css/movie_page.css' %}">
    <script src="{% static 'movies/js/movie_page.js' %}" defer></script>
  </head>

  <body>
    <div class="movieBanner"
         style="background-image: url('{% if movie.backdrops %}{{ movie.backdrops.1 }}{% else %}{% static 'movies/ui/default_backdrop.png' %}{% endif %}');" 
         >
    </div>
    <main class="movieContainer">
      <div class="moviePosterContainer">
        {% if not movie.imgURL %}
          <img id="moviePoster" src="{% static 'movies/ui/default_poster.png' %}" alt="Default Movie Poster" />
        {% else %}
          <img id="moviePoster" src="{{ movie.imgURL }}" alt="Movie Poster" />
        {% endif %}
      </div>
      <div class="titleContainer">
        <h1>{{ movie.title|default:"Wer das liest ist wunderschön ^^" }}</h1>
      </div>
      <div id="movieDetailsContainer" class="movieDetailsContainer">
        <span id="rating" class="defaultContainer">
          <img src="{% static 'movies/ui/star.svg' %}" alt="Star Icon" class="icon" />
          <h2>{{ movie.jwRating|default:"-"|floatformat:2}}/1</h2>
        </span>
        <span id="popularity" class="defaultContainer">
          <img src="{% static 'movies/ui/tomato.svg' %}" alt="Tomato Icon" class="icon" />
          <h2>{{ movie.tomatoMeter|default:"--" }}</h2>
        </span>
        <span id="duration" class="defaultContainer">
          <img src="{% static 'movies/ui/clock.svg' %}" alt="Clock Icon" class="icon" />
          <h2>{{movie.runtime|default:"--" }} min</h2>
        </span>
        <span id="releaseYear" class="defaultContainer">
          <img src="{% static 'movies/ui/calendar.svg' %}" alt="Calendar Icon" class="icon" />
          <h2>{{ movie.year|default:"--" }}</h2>
        </span>
        <span id="addHallOfFame" class="defaultContainer">
          <button class="greenButton" onclick="openWatchedModal()">watched</button>
        </span>

      </div>
      <div class="votesContainer">
        {% for user in movie.votes.all %}
          {% if user.userprofile.profile_image %}
            <img src="{{ user.userprofile.profile_image.url }}" alt="{{ user.username }}" class="voteProfilePicture" title="{{ user.username }}">
          {% else %}
            <div class="voteProfilePicture" style="display:flex;align-items:center;justify-content:center;font-size:2em;background:#333;">
              {{ user.username|first|upper }}
            </div>
          {% endif %}
        {% endfor %}
      </div>
      <div id="offerContainer">
        {% for offer in offers %}
          <div class="offerButton">{{ offer.name }}</div>
        {% empty %}
          <div class="offerButton">Keine Flatrate Angebote verfügbar</div>
        {% endfor %}
      </div>
    </main>
    <footer>
      <div id="offerContainerFooter">
      {% for offer in offers %}
        <div class="offerButton">{{ offer.name }}</div>
      {% empty %}
        <div class="offerButton">Keine Flatrate Angebote verfügbar</div>
      {% endfor %}
      </div>
      <a href="{{ movie.jwURL }}" target="_blank"> 
        <img
          class="jwButton img-Button"
          src="{% static 'movies/ui/JustWatch.png' %}"
          alt="Just Watch Logo"
        />
      </a>

      <a href="https://www.imdb.com/title/{{ movie.imdbID }}/" target="_blank">
        <img class="img-Button" src="{% static 'movies/ui/IMDb.svg' %}" alt="IMDb Logo" />
      </a>

    </footer>

    <!-- Modal für Movie Event -->
    <div id="watchedModal" class="modal" style="display: none;">
      <div class="modal-content">
        <span class="close" onclick="closeWatchedModal()">&times;</span>
        <h2>Pizza-Abend hinzufügen</h2>
        <hr>
        <form id="watchedForm" class="modalForm" method="post" action="{% url 'movies:add_movie_event' movie.id %}">
          {% csrf_token %}
          
          <!-- Datum auswählen -->
          <div class="form-group">
            <label for="eventDate">Datum:</label>
            <input type="date" id="eventDate" name="date" required>
          </div>
          
          <!-- Attendees auswählen -->
          <div class="form-group">
            <label>Teilnehmer (mindestens einen auswählen):</label>
            <div class="attendees-container">
              {% for user in users %}
                <div class="user-avatar-attendee" 
                     data-user-id="{{ user.id }}" 
                     data-username="{{ user.username }}"
                     title="{{ user.username }}"
                     onclick="toggleAttendee(this)">
                  
                  {% if user.userprofile.profile_image %}
                    <img src="{{ user.userprofile.profile_image.url }}" alt="{{ user.username }}">
                  {% else %}
                    <div class="avatar-fallback">{{ user.username|first|upper }}</div>
                  {% endif %}
                  
                  <input type="checkbox" 
                         name="attendees" 
                         value="{{ user.id }}" 
                         style="display: none;">
                </div>
              {% endfor %}
            </div>
          </div>
          
          <!-- Rating von 0-10 -->
          <div class="form-group">
            <label for="eventRating">Rating (0-10):</label>
            <input type="number" id="eventRating" name="rating" min="0" max="10" step="0.1" required>
          </div>
          
          <div class="form-buttons">
            <button type="button" onclick="closeWatchedModal()" class="cancelButton">Abbrechen</button>
            <button type="submit" class="greenButton" onclick="return validateForm()">Hinzufügen</button>
          </div>
        </form>
      </div>
    </div>
  </body>
</html>
